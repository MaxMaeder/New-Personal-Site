---
import PageLayout from "../../layouts/PageLayout.astro";
import { getPosts, type Post } from "../../lib/contentful/posts";
import showdown from "showdown";

export async function getStaticPaths() {
  const posts = await getPosts()
  const pages = posts.map((post) => ({
    params: { slug: post.slug },
    props: {
      post,
    },
  }));
  return pages;
}

interface Props {
  post: Post;
}

const { post } = Astro.props;
const mdConverter = new showdown.Converter();
showdown.setFlavor("github")
showdown.setOption("smartIndentationFix", true)
showdown.setOption("tables", true)
---

<PageLayout>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <article set:html={mdConverter.makeHtml(post.content)} />
</PageLayout>

<style>
  article {
    padding: 1rem 4rem;
  }
</style>

<script>
  import hljs from "highlight.js";
  hljs.highlightAll();
</script>